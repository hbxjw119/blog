---
title: 一道面试题：随机洗牌法
date: 2017-10-15 09:14:35
tags: [python, algorithm, 面试]
mathjax: true
category: [Tech]
---

面试时，遇到这么一个问题，觉得比较有意思，可惜我答得不好，特记录下。
<!--more-->

面试官：请设计一个扑克牌发牌的程序
我：最初回答的很简单：先生成一副牌，再将牌随机打乱，然后平均分给4个数组
面试官：怎么将牌随机打乱呢？
我：Python中有个shuffle函数，可以随机打乱
面试官：如果不用shuffle函数呢？
我：想了会儿，用随机数生成器，随机生成两张牌的索引，然后交换。
面试官：需要交换多少次？
我：懵逼+黑人问号脸。。。

后来查了下，其实这是一个经典的算法题：随机洗牌法。该算法要保证：任何一张牌，在所有的位置上的概率相同，或者说，有N张牌，每张牌出现在任何位置的概率都为1/N。具体操作如下：

将扑克牌看做一个数组，依次遍历数组，对第n个元素，以1/n的概率，与前n个元素中的某个元素的位置互换，最后生成的序列，即可满足要求。具体python版本实现如下：
```python
import random

def shuffle(poker_list):
	l = len(poker_list)
	for i,pk in enumerate(poker_list):
		idx = random.randint(0,l) % (i + 1)
		poker_list[idx], poker_list[i] = poker_list[i],poker_list[idx]
```

## 证明

先考察只有几个元素时的情况：
1. 当n=1时，一个元素放在一个位置的概率为1 
2. 当n=2时，根据算法，第一个位置已经暂且定下位置。第二个元素只能随机两个数字，概率均为1/2，第一个元素要么和第二个元素置换，要么位置不变，两个元素在任意这两个位置的概率都是1/2。 
3. 当n=3时，根据算法，前两个元素已经暂且定下位置。我们先看看第3个元素在任意位置的概率是多少？就是1/3，因为随机出来的3个数字的概率相同。在没有第3个元素和第3个位置时，前两个元素的任意位置概率是1/2，那现在有3个位置，自然概率就要变化：假设第一个位置的元素值是10，那么这个10现在只有两种情况，要么保持位置不变，要么和第3个位置交换。 
1）保持位置不变的概率是10在前两个位置的概率乘以新随机的数不是该位置的概率，即1/2×(1−1/3)，结果是1/3。 
2）与第3个位置进行交换的概率是10在第一个位置的概率乘以随机出第一个位置数的概率加上10在第二个位置的概率乘以随机出第二个位置数的概率，即1/2×1/3+1/2×1/3，结果为1/3。 
综上，第一个位置的随机到任意位置的概率为1/3。第二个位置也可以这么证明，所以干脆下面证明时直接说是任意一位置。

下面给出严谨证明，要用到数学归纳法：
基础步骤： 当n=1时，第一位置元素只能随机出1，概率为1，定理成立。 
归纳步骤： 当n=k，k个元素在任k个位置的概率均为$\frac {1}{k}$成立。 
当n=k+1,第k+1位置的元素在任k+1个位置的概率是$\frac {1}{k+1}$，因为随机出k+1个数概率是一样的。前k个元素的概率发生了变化，任意一元素保持位置不变的概率为$\frac {1}{k}$ × ($1-\frac {1}{k+1}$),结果为$\frac {1}{k+1}$;任意一元素与第k+1元素进行置换的概率为$\frac {1}{k} × (\sum_{1}^{k}\frac {1}{k}× \frac {1}{k+1})$ ,结果为$\frac {1}{k+1}$,综上，前k个元素在任意位置的概率为$\frac {1}{k+1}$。 
定理成立，证毕。

#### 参考
http://blog.csdn.net/crawler_star/article/details/50354276
